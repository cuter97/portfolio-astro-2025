---
import { type CollectionEntry } from "astro:content";
import { CardProject } from "@/components/common/CardProject";
import type { lenguages } from "@/i18n/ui";
import { useTranslation } from "@/lib/utils";

interface Props {
  filteredProjects?: CollectionEntry<"project">[];
  filteredSkills?: CollectionEntry<"skill">[];
}

const currentLang = Astro.currentLocale || "en";
const t = useTranslation(currentLang as keyof typeof lenguages);
const { filteredProjects, filteredSkills } = Astro.props as Props;
---

<section id="projects" class="space-y-4 scroll-mt-24">
  <h3 class="text-3xl font-titan-one uppercase">
    {t("index.projects.title")}
  </h3>
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 projects-grid">
    {
      filteredProjects?.map((proj) => {
        const projSkills = filteredSkills?.filter((skill) =>
          proj.data.tags.some((tag) => skill.id.endsWith(tag.id))
        );
        return (
          <div class="project-card-wrapper">
            <CardProject
              client:load
              info={proj}
              skills={projSkills}
              currentLang={currentLang as keyof typeof lenguages}
            />
          </div>
        );
      })
    }
    <div class="project-card-wrapper">
      <a
        href={`/${currentLang}/projects`}
        class="view-more-card flex flex-col items-center justify-center gap-3 h-full min-h-[160px] rounded-xl border border-border bg-card text-card-foreground transition-all duration-300 hover:bg-accent hover:border-accent-foreground/20 group p-6"
      >
        <div class="icon-wrapper flex items-center justify-center w-12 h-12 rounded-full border border-border bg-background transition-all duration-300 group-hover:scale-110 group-hover:border-primary/40">
          <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-muted-foreground group-hover:text-foreground transition-colors duration-300">
            <path d="M5 12h14"/><path d="m12 5 7 7-7 7"/>
          </svg>
        </div>
        <span class="text-base font-semibold tracking-tight text-muted-foreground group-hover:text-foreground transition-colors duration-300">
          {currentLang === 'es' ? 'Ver m√°s proyectos' : 'View more projects'}
        </span>
      </a>
    </div>
  </div>
 <div class="flex justify-center pt-4">
    <a
      href="https://cuterdev.lemonsqueezy.com/" 
      target="_blank"
      rel="noopener noreferrer"
      class="group relative inline-flex items-center justify-center px-8 py-3 font-medium tracking-tighter text-white bg-[#181818] rounded-xl overflow-hidden transition-all duration-300 hover:ring-2 hover:ring-offset-2 hover:ring-white/20 active:scale-95"
    >
      <span class="absolute inset-0 bg-gradient-to-r from-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></span>
      <span class="relative flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform group-hover:rotate-12"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
        {currentLang === 'es' ? 'Explora mi tienda de templates' : 'Browse my template store'}
      </span>
    </a>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  setTimeout(() => {
    const projectCards = document.querySelectorAll(".project-card-wrapper");

    projectCards.forEach((card, index) => {
      gsap.set(card, {
        opacity: 0,
        rotationY: -90,
        transformPerspective: 1000,
        transformOrigin: "center center",
      });

      gsap.to(card, {
        scrollTrigger: {
          trigger: card,
          start: "top 85%",
        },
        opacity: 1,
        rotationY: 0,
        duration: 0.8,
        ease: "power2.out",
        delay: index * 0.15,
      });
    });
  }, 100);
</script>

<style>
  .project-card-wrapper {
    transform-style: preserve-3d;
  }
</style>
